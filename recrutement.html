<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recrutement - Institut de Formation Lafaom-Mao</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/swiper-testimonials.css">
    <link rel="icon" type="image/png" href="assets/Images/logo.png">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header" id="header">
        <nav class="navbar container">
            <a href="index.html" class="brand">
                <img src="assets/Images/logo.png" alt="Lafaom Mao" class="brand-logo">
                <span class="brand-text">Institut Lafaom-Mao</span>
            </a>
            <div class="burger" id="burger">
                <span class="burger-line"></span>
                <span class="burger-line"></span>
                <span class="burger-line"></span>
            </div>
            <div class="menu" id="menu">
                <ul class="menu-inner">
                    <li class="menu-item"><a href="about.html" class="menu-link">Institut</a></li>
                    <li class="menu-item"><a href="actualite.html" class="menu-link">Actualités</a></li>
                    <li class="menu-item"><a href="#" class="menu-link">Recrutement</a></li>
                    <li class="menu-item"><a href="#" class="menu-link">Formation</a></li>
                </ul>
            </div>
            <span class="overlay"></span>
            <a href="#" class="btn btn-primary menu-cta">Espace Candidat</a>
        </nav>
    </header>

    <main class="main">
        <!-- Hero Section -->
        <section class="page-hero" style="background-image: url('/assets/Images/banner2.jpg');">
            <div class="container about-container">
                <div class="page-hero-content">
                    <div class="hero-colored-box">
                        <h1 class="title-large">RECRUTEMENT - INSTITUT DE FORMATION LAFAOM-MAO</h1>
                        <div class="hero-subtitle">
                            <div class="hero-line"></div>
                            <p class="text-large">Rejoignez notre équipe et participez à la formation des AVMJ</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recruitment Sections -->
        <section class="recruitment-sections">
            <div class="container">
                <!-- Devenir bénévole -->
                <div class="recruitment-section">
                    <h2 class="recruitment-title">Devenir bénévole</h2>
                    <div class="recruitment-line"></div>
                    <p class="recruitment-text">
                        Vous adhérez au projet de l'Institut Lafaom-Mao et souhaitez vous investir dans une action utile dans un monde de valeurs ? 
                        Vous pouvez nous apporter votre soutien en nous donnant un peu de votre temps.
                    </p>
                    <p class="recruitment-text-secondary">
                        Nous mettons ponctuellement en ligne des offres de bénévolat, en fonction des besoins : retrouvez nos offres sur cette page.
                    </p>
                </div>

                <!-- Devenir formateur -->
                <div class="recruitment-section">
                    <h2 class="recruitment-title">Devenir formateur</h2>
                    <div class="recruitment-line"></div>
                    <p class="recruitment-text">
                        Vous êtes un professionnel expérimenté dans le domaine judiciaire ou de la formation et souhaitez partager votre expertise ? 
                        Rejoignez notre réseau de formateurs et contribuez à la formation des Auxiliaires de Vie en Univers Judiciaire.
                    </p>
                    <p class="recruitment-text-secondary">
                        Nous recherchons des formateurs qualifiés pour nos programmes de formation : découvrez nos offres de postes de formateurs sur cette page.
                    </p>
                </div>

                <!-- Effectuer un stage -->
                <div class="recruitment-section">
                    <h2 class="recruitment-title">Effectuer un stage</h2>
                    <div class="recruitment-line"></div>
                    <p class="recruitment-text">
                        L'Institut Lafaom-Mao accueille régulièrement au sein de l'équipe des étudiants sous convention pour des missions courtes, 
                        dans le cadre de leur cursus ou de leur projet professionnel. Les candidatures motivées par un désir d'engagement 
                        dans la formation professionnelle ou un intérêt pour le secteur associatif sont valorisées.
                    </p>
                    <p class="recruitment-text-secondary">
                        Nous ne pouvons malheureusement répondre aux nombreuses propositions spontanées : retrouvez toutes nos offres sur cette page et postulez en ligne.
                    </p>
                </div>
            </div>
        </section>

        <!-- Job Offers Section -->
        <section class="job-offers-section">
            <div class="container">
                <div class="job-offers-header">
                    <h2 class="job-offers-title">Offres d'emploi</h2>
                    <p class="job-offers-subtitle">DÉCOUVREZ NOS POSTES DISPONIBLES</p>
                </div>

                <!-- Filters and Search -->
                <div class="job-filters">
                    <div class="filter-group">
                        <div class="search-filter">
                            <label class="filter-label" for="jobSearch">Rechercher</label>
                            <input type="text" id="jobSearch" class="filter-input" placeholder="Rechercher un poste, une localisation...">
                        </div>
                        <div class="location-filter">
                            <label class="filter-label" for="locationSelect">Localisation</label>
                            <select id="locationSelect" class="filter-select">
                                <option value="all">Toutes les localisations</option>
                            </select>
                        </div>
                        <div class="contract-filter">
                            <label class="filter-label" for="contractSelect">Type de contrat</label>
                            <select id="contractSelect" class="filter-select">
                                <option value="all">Tous les contrats</option>
                                <option value="CDI">CDI</option>
                                <option value="CDD">CDD</option>
                                <option value="Stage">Stage</option>
                                <option value="Bénévolat">Bénévolat</option>
                            </select>
                        </div>
                        <div class="salary-filter">
                            <label class="filter-label" for="salarySelect">Salaire minimum</label>
                            <select id="salarySelect" class="filter-select">
                                <option value="all">Tous les salaires</option>
                                <option value="500">500+ EUR</option>
                                <option value="1000">1000+ EUR</option>
                                <option value="1500">1500+ EUR</option>
                                <option value="2000">2000+ EUR</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Loading State -->
                <div id="loadingOffers" class="loading-container">
                    <div class="loading-spinner"></div>
                    <p>Chargement des offres d'emploi...</p>
                </div>

                <!-- Job Offers Grid -->
                <div id="jobOffersGrid" class="job-offers-grid" style="display: none;">
                    <!-- Les offres seront chargées dynamiquement -->
                </div>

                <!-- Error State -->
                <div id="errorOffers" class="error-container" style="display: none;">
                    <div class="error-icon">
                        <i class="bx bx-error-circle"></i>
                    </div>
                    <h3>Erreur de chargement</h3>
                    <p>Impossible de charger les offres d'emploi. Veuillez réessayer plus tard.</p>
                    <button id="retryButton" class="btn btn-primary">Réessayer</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Offcanvas for Job Details -->
    <div id="jobOffcanvas" class="job-offcanvas">
        <div class="offcanvas-overlay"></div>
        <div class="offcanvas-content">
            <div class="offcanvas-header">
                <h2 id="offcanvasTitle" class="offcanvas-title">Détails de l'offre</h2>
                <button id="closeOffcanvas" class="offcanvas-close">
                    <i class="bx bx-x"></i>
                </button>
            </div>
            <div class="offcanvas-body">
                <div id="offcanvasContent">
                    <!-- Le contenu sera chargé dynamiquement -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="footer-col">
                    <h4>Institut</h4>
                    <ul>
                        <li><a href="about.html">À propos</a></li>
                        <li><a href="#">Formation AVMJ</a></li>
                        <li><a href="#">Programme Mao</a></li>
                        <li><a href="#">Certification</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Formation</h4>
                    <ul>
                        <li><a href="#">Candidature</a></li>
                        <li><a href="#">Programme</a></li>
                        <li><a href="#">Calendrier</a></li>
                        <li><a href="#">Frais de formation</a></li>
                        <li><a href="#">Bourses</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Contact</h4>
                    <ul>
                        <li><a href="tel:+221123456789">+221 123 456 789</a></li>
                        <li><a href="#">Ziguinchor, Sénégal</a></li>
                        <li><a href="#">Dakar, Sénégal</a></li>
                        <li><a href="#">Nous contacter</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Suivez-nous</h4>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="footer-copyright">
                    <p>2025 © <a href="#" target="_blank">INSTITUT DE FORMATION LAFAOM-MAO</a></p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/country-list-js@2.2.0/dist/country-list.min.js"></script>
    <script src="js/base.js"></script>
    <script src="js/recruitment.js"></script>
    <script src="js/swiper-init.js"></script>

    <!-- Application Modal -->
    <div id="applicationModal" class="application-modal">
        <div class="modal-wrap">
            <div class="modal-header">
                <span class="is-active"></span>
                <span></span>
                <span></span>
            </div>
            <div class="modal-bodies">
                <!-- Step 1: Personal Information -->
                <div class="modal-body modal-body-step-1 is-showing">
                    <div class="title">Étape 1</div>
                    <div class="description">Informations personnelles</div>
                    <form id="step1Form">
                        <div class="form-group">
                            <label class="form-label required" for="civility">Civilité</label>
                            <select class="form-select" id="civility" name="civility" required>
                                <option value="">Sélectionner</option>
                                <option value="Monsieur">Monsieur</option>
                                <option value="Madame">Madame</option>
                                <option value="Mademoiselle">Mademoiselle</option>
                            </select>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label required" for="firstName">Prénom</label>
                                <input type="text" class="form-input" id="firstName" name="first_name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label required" for="lastName">Nom</label>
                                <input type="text" class="form-input" id="lastName" name="last_name" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label required" for="email">Email</label>
                                <input type="email" class="form-input" id="email" name="email" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label required" for="phone">Téléphone</label>
                                <input type="tel" class="form-input" id="phone" name="phone_number" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label required" for="country">Pays</label>
                                <select class="form-select" id="country" name="country" required>
                                    <option value="">Sélectionner un pays</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label required" for="city">Ville</label>
                                <input type="text" class="form-input" id="city" name="city" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="phoneCode">Code téléphonique</label>
                            <select class="form-select" id="phoneCode" name="country_code" required>
                                <option value="">Sélectionner un code</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="address">Adresse complète</label>
                            <textarea class="form-textarea" id="address" name="address" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required" for="dateOfBirth">Date de naissance</label>
                            <input type="date" class="form-input" id="dateOfBirth" name="date_of_birth" required>
                        </div>
                        
                        <div class="form-actions">
                            <div class="button btn-secondary" onclick="prevStep()" style="display: none;">Précédent</div>
                            <div class="button" onclick="nextStep()">Continuer</div>
                        </div>
                    </form>
                </div>

                <!-- Step 2: Documents -->
                <div class="modal-body modal-body-step-2">
                    <div class="title">Étape 2</div>
                    <div class="description">Documents à joindre</div>
                    <form id="step2Form">
                        <div class="form-group">
                            <label class="form-label">Pièces jointes</label>
                            <div class="file-upload" id="fileUpload">
                                <div class="file-upload-icon">
                                    <i class="bx bx-cloud-upload"></i>
                                </div>
                                <div class="file-upload-text">
                                    Glissez-déposez vos fichiers ici ou cliquez pour sélectionner
                                </div>
                                <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" style="display: none;">
                            </div>
                            <div class="file-list" id="fileList"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="coverLetter">Lettre de motivation (optionnel)</label>
                            <textarea class="form-textarea" id="coverLetter" name="cover_letter" placeholder="Décrivez votre motivation pour ce poste..."></textarea>
                        </div>
                        
                        <div class="form-actions fade-in">
                            <div class="button btn-secondary" onclick="prevStep()">Précédent</div>
                            <div class="button" onclick="nextStep()">Continuer</div>
                        </div>
                    </form>
                </div>

                <!-- Step 3: Confirmation -->
                <div class="modal-body modal-body-step-3">
                    <div class="title">Étape 3</div>
                    <div class="description">Confirmation et envoi</div>
                    <div id="confirmationData"></div>
                    <div class="form-actions">
                        <div class="button btn-secondary" onclick="prevStep()">Précédent</div>
                        <div class="button" onclick="submitApplication()">Envoyer la candidature</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="text-center">
            <div class="rerun-button" onclick="closeApplicationModal()" style="display: none;">Fermer</div>
        </div>
        
       
    </div>

    <!-- Application Form Styles -->
    <style>
        .application-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .application-modal.show {
            display: flex;
        }

        .title {
            text-transform: uppercase;
            text-align: center;
            margin-bottom: 30px;
            color: var(--color-primary);
            font-weight: 300;
            font-size: 24px;
            letter-spacing: 1px;
        }

        .description {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        input[type=text],
        input[type=email],
        input[type=tel],
        input[type=date],
        select,
        textarea {
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            display: block;
            width: 100%;
            margin-bottom: 20px;
            box-sizing: border-box;
            outline: none;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        input[type=text]:focus,
        input[type=email]:focus,
        input[type=tel]:focus,
        input[type=date]:focus,
        select:focus,
        textarea:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(212, 51, 132, 0.1);
            transform: translateY(-1px);
        }

        input[type=radio] {
            margin-right: 10px;
        }

        label {
            margin-bottom: 20px;
            display: block;
            font-size: 18px;
            color: #666;
            border-top: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
            padding: 20px 0;
            cursor: pointer;
        }

        label:first-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .button,
        .rerun-button {
            padding: 12px 24px;
            border-radius: 8px;
            background: var(--color-primary);
            color: white;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: inline-block;
            cursor: pointer;
            border: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .button:hover,
        .rerun-button:hover {
            background: #8B2635;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 51, 132, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .button.rerun-button,
        .rerun-button.rerun-button {
            border: 1px solid rgba(255, 255, 255, 0.6);
            margin-bottom: 50px;
            box-shadow: 0px 10px 15px -6px rgba(0, 0, 0, 0.2);
            display: none;
        }

        .text-center {
            text-align: center;
        }

        .modal-wrap {
            max-width: 700px;
            width: 100%;
            max-height: 85vh;
            margin: 0;
            transition: transform 300ms ease-in-out;
            background: white;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            height: 45px;
            background: white;
            border-bottom: 1px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-header span {
            display: block;
            height: 12px;
            width: 12px;
            margin: 5px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.2);
        }

        .modal-header span.is-active {
            background: var(--color-primary);
        }

        .modal-bodies {
            position: relative;
            perspective: 1000px;
            flex: 1;
            overflow-y: auto;
        }

        .modal-body {
            background: white;
            padding: 30px 60px;
            margin-bottom: 50px;
            position: absolute;
            top: 0;
            left: 0;
            display: none;
            box-sizing: border-box;
            width: 100%;
            transform-origin: top left;
            min-height: 400px;
        }

        .modal-body.is-showing {
            display: block;
            position: relative;
        }

        .animate-out {
            -webkit-animation: out 600ms ease-in-out forwards;
            animation: out 600ms ease-in-out forwards;
        }

        .animate-in {
            -webkit-animation: in 500ms ease-in-out forwards;
            animation: in 500ms ease-in-out forwards;
            display: block;
        }

        .animate-up {
            transform: translateY(-500px) rotate(30deg);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-label.required::after {
            content: " *";
            color: var(--color-primary);
        }

        /* Enhanced select styling */
        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
            cursor: pointer;
        }

        select:hover {
            border-color: var(--color-primary);
            background-color: #f8f9fa;
        }

        select option {
            padding: 8px 12px;
            background: white;
            color: #333;
        }

        select option:hover {
            background: var(--color-primary);
            color: white;
        }

        /* Validation styles */
        .form-input.error,
        .form-select.error,
        .form-textarea.error {
            border-color: #dc3545 !important;
            background-color: #fff5f5;
            animation: shake 0.5s ease-in-out;
        }

        .form-input.error:focus,
        .form-select.error:focus,
        .form-textarea.error:focus {
            border-color: #dc3545 !important;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1) !important;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .error-message {
            color: #dc3545;
            font-size: 12px;
            margin-top: 5px;
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .error-message.show {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .file-upload {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: var(--color-primary);
            background: #f8f9fa;
        }

        .file-upload.dragover {
            border-color: var(--color-primary);
            background: rgba(212, 51, 132, 0.1);
        }

        .file-upload-icon {
            font-size: 2rem;
            color: #666;
            margin-bottom: 10px;
        }

        .file-upload-text {
            color: #666;
            margin-bottom: 10px;
        }

        .file-list {
            margin-top: 15px;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .file-name {
            flex: 1;
            margin-right: 10px;
        }

        .file-remove {
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @-webkit-keyframes out {
            0% {
                transform: translateY(0px) rotate(0deg);
            }
            60% {
                transform: rotate(60deg);
            }
            100% {
                transform: translateY(800px) rotate(10deg);
            }
        }

        @keyframes out {
            0% {
                transform: translateY(0px) rotate(0deg);
            }
            60% {
                transform: rotate(60deg);
            }
            100% {
                transform: translateY(800px) rotate(10deg);
            }
        }

        @-webkit-keyframes in {
            0% {
                opacity: 0;
                transform: rotateX(-90deg);
            }
            100% {
                opacity: 1;
                transform: rotateX(0deg);
            }
        }

        @keyframes in {
            0% {
                opacity: 0;
                transform: rotateX(-90deg);
            }
            100% {
                opacity: 1;
                transform: rotateX(0deg);
            }
        }

        @media (max-width: 768px) {
            .application-modal {
                padding: 10px;
            }

            .modal-wrap {
                max-width: 100%;
                width: 100%;
                max-height: 95vh;
            }

            .modal-body {
                padding: 20px 25px;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            input[type=text],
            input[type=email],
            input[type=tel],
            input[type=date],
            select,
            textarea {
                padding: 10px 14px;
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }

        @media (max-width: 480px) {
            .modal-body {
                padding: 15px 20px;
            }

            .title {
                font-size: 20px;
            }

            .description {
                font-size: 14px;
            }
        }
    </style>

    <!-- Application Form Script -->
    <script>
        let currentJobOfferId = null;
        let attachments = [];

        function openApplicationModal(jobOfferId) {
            currentJobOfferId = jobOfferId;
            document.getElementById('applicationModal').classList.add('show');
            document.body.style.overflow = 'hidden';
            resetForm();
        }

        function closeApplicationModal() {
            document.getElementById('applicationModal').classList.remove('show');
            document.body.style.overflow = '';
            resetForm();
        }

        function resetForm() {
            // Reset to step 1
            document.querySelectorAll('.modal-body').forEach(body => {
                body.classList.remove('is-showing', 'animate-out', 'animate-in');
                body.style.display = 'none';
            });
            document.querySelector('.modal-body-step-1').style.display = 'block';
            document.querySelector('.modal-body-step-1').classList.add('is-showing');
            
            // Reset step indicators
            document.querySelectorAll('.modal-header span').forEach((span, index) => {
                span.classList.toggle('is-active', index === 0);
            });
            
            // Reset forms
            document.getElementById('step1Form').reset();
            document.getElementById('step2Form').reset();
            attachments = [];
            updateFileList();
            
            // Clear any errors
            clearErrors();
            
            // Hide rerun button
            document.querySelector('.rerun-button').style.display = 'none';
        }

        // Button click handler - ignore previous buttons
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('button') && !e.target.classList.contains('btn-secondary')) {
                const btn = e.target;
                const step = btn.closest('.modal-body');
                const stepIndex = Array.from(document.querySelectorAll('.modal-body')).indexOf(step);
                const pag = document.querySelectorAll('.modal-header span')[stepIndex];

                if (stepIndex === 0) { 
                    step1(step, pag); 
                } else if (stepIndex === 1) {
                    step2(step, pag);
                } else { 
                    step3(step, pag); 
                }
            }
        });

        function step1(step, pag) {
            console.log('step1');
            // Validate step 1
            if (!validateStep1()) {
                return;
            }
            
            // Hide ALL steps first
            document.querySelectorAll('.modal-body').forEach(body => {
                body.style.display = 'none';
                body.classList.remove('animate-out', 'animate-in', 'is-showing');
            });
            
            // Show ONLY the next step
            const nextStep = step.nextElementSibling;
            nextStep.style.display = 'block';
            nextStep.classList.add('is-showing');
            
            // Update pagination
            pag.classList.remove('is-active');
            pag.nextElementSibling.classList.add('is-active');
            
            // Add entrance animation
            setTimeout(function(){
                nextStep.classList.add('animate-in');
            }, 50);
            
            // Clean up animation class
            setTimeout(function(){
                nextStep.classList.remove('animate-in');
            }, 600);
        }

        function step2(step, pag) {
            console.log('step2');
            // Update confirmation data
            updateConfirmationData();
            
            // Hide ALL steps first
            document.querySelectorAll('.modal-body').forEach(body => {
                body.style.display = 'none';
                body.classList.remove('animate-out', 'animate-in', 'is-showing');
            });
            
            // Show ONLY the next step
            const nextStep = step.nextElementSibling;
            nextStep.style.display = 'block';
            nextStep.classList.add('is-showing');
            
            // Update pagination
            pag.classList.remove('is-active');
            pag.nextElementSibling.classList.add('is-active');
            
            // Add entrance animation
            setTimeout(function(){
                nextStep.classList.add('animate-in');
            }, 50);
            
            // Clean up animation class
            setTimeout(function(){
                nextStep.classList.remove('animate-in');
            }, 600);
        }

        function step3(step, pag) {
            console.log('step3');
            // Submit application
            submitApplication();
        }

        function validateStep1() {
            const requiredFields = document.querySelectorAll('#step1Form [required]');
            let isValid = true;
            
            // Clear previous errors
            clearErrors();
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('error');
                    showFieldError(field, 'Ce champ est obligatoire');
                    isValid = false;
                } else {
                    field.classList.remove('error');
                    hideFieldError(field);
                }
            });
            
            if (!isValid) {
                // Scroll to first error
                const firstError = document.querySelector('#step1Form .error');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
            
            return isValid;
        }

        function validateStep2() {
            // Step 2 is optional, so always return true
            return true;
        }

        function clearErrors() {
            document.querySelectorAll('.error').forEach(field => {
                field.classList.remove('error');
            });
            document.querySelectorAll('.error-message').forEach(msg => {
                msg.classList.remove('show');
            });
        }

        function showFieldError(field, message) {
            // Remove existing error message
            const existingError = field.parentNode.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }
            
            // Add new error message
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message show';
            errorDiv.textContent = message;
            field.parentNode.appendChild(errorDiv);
        }

        function hideFieldError(field) {
            const errorMsg = field.parentNode.querySelector('.error-message');
            if (errorMsg) {
                errorMsg.classList.remove('show');
                setTimeout(() => errorMsg.remove(), 300);
            }
        }

        function prevStep() {
            const currentStep = document.querySelector('.modal-body.is-showing');
            const stepIndex = Array.from(document.querySelectorAll('.modal-body')).indexOf(currentStep);
            const prevStep = currentStep.previousElementSibling;
            const pag = document.querySelectorAll('.modal-header span')[stepIndex];

            if (stepIndex > 0) {
                // Clear any error states
                clearErrors();
                
                // Hide ALL steps first
                document.querySelectorAll('.modal-body').forEach(body => {
                    body.style.display = 'none';
                    body.classList.remove('animate-out', 'animate-in', 'is-showing');
                });
                
                // Show ONLY the previous step
                prevStep.style.display = 'block';
                prevStep.classList.add('is-showing');
                
                // Update pagination
                pag.classList.remove('is-active');
                pag.previousElementSibling.classList.add('is-active');
                
                // Add entrance animation
                setTimeout(function(){
                    prevStep.classList.add('animate-in');
                }, 50);
                
                // Clean up animation class
                setTimeout(function(){
                    prevStep.classList.remove('animate-in');
                }, 600);
            }
        }

        function updateConfirmationData() {
            const formData1 = new FormData(document.getElementById('step1Form'));
            const formData2 = new FormData(document.getElementById('step2Form'));
            const data1 = Object.fromEntries(formData1.entries());
            const data2 = Object.fromEntries(formData2.entries());
            
            const confirmationDiv = document.getElementById('confirmationData');
            confirmationDiv.innerHTML = `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h4>Informations personnelles</h4>
                    <p><strong>Nom complet:</strong> ${data1.civility} ${data1.first_name} ${data1.last_name}</p>
                    <p><strong>Email:</strong> ${data1.email}</p>
                    <p><strong>Téléphone:</strong> ${data1.country_code} ${data1.phone_number}</p>
                    <p><strong>Pays:</strong> ${data1.country}</p>
                    <p><strong>Adresse:</strong> ${data1.address}, ${data1.city}</p>
                    <p><strong>Date de naissance:</strong> ${data1.date_of_birth}</p>
                    ${attachments.length > 0 ? `
                    <h4>Documents joints</h4>
                    <ul>
                        ${attachments.map(file => `<li>${file.name}</li>`).join('')}
                    </ul>
                    ` : ''}
                    ${data2.cover_letter ? `
                    <h4>Lettre de motivation</h4>
                    <p>${data2.cover_letter}</p>
                    ` : ''}
                </div>
            `;
        }

        async function submitApplication() {
            if (!currentJobOfferId) {
                alert('ID de l\'offre d\'emploi manquant.');
                return;
            }

            const formData1 = new FormData(document.getElementById('step1Form'));
            const formData2 = new FormData(document.getElementById('step2Form'));
            const data1 = Object.fromEntries(formData1.entries());
            const data2 = Object.fromEntries(formData2.entries());

            // Prepare attachments
            const attachmentData = attachments.map(file => ({
                name: file.name,
                url: `https://example.com/uploads/${file.name}`
            }));

            // Prepare API payload
            const payload = {
                job_offer_id: currentJobOfferId,
                email: data1.email,
                phone_number: data1.phone_number,
                first_name: data1.first_name,
                last_name: data1.last_name,
                civility: data1.civility,
                country_code: data1.country_code,
                country: data1.country,
                city: data1.city,
                address: data1.address,
                date_of_birth: data1.date_of_birth,
                attachments: attachmentData
            };

            try {
                const response = await fetch('https://lafaom.vertex-cam.com/api/v1/job-applications', {
                    method: 'POST',
                    headers: {
                        'accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    // Show success animation
                    const currentStep = document.querySelector('.modal-body.is-showing');
                    const stepIndex = Array.from(document.querySelectorAll('.modal-body')).indexOf(currentStep);
                    const pag = document.querySelectorAll('.modal-header span')[stepIndex];
                    
                    // animate the step out
                    currentStep.closest('.modal-wrap').classList.add('animate-up');

                    setTimeout(function(){
                        document.querySelector('.rerun-button').style.display = 'inline-block';
                    }, 300);
                } else {
                    const errorData = await response.json();
                    alert(`Erreur lors de l'envoi: ${errorData.message || 'Erreur inconnue'}`);
                }

            } catch (error) {
                console.error('Error submitting application:', error);
                alert('Erreur de connexion. Veuillez réessayer.');
            }
        }

        // File upload functionality
        function initFileUpload() {
            const fileUpload = document.getElementById('fileUpload');
            const fileInput = document.getElementById('fileInput');

            if (fileUpload && fileInput) {
                fileUpload.addEventListener('click', () => fileInput.click());
                fileUpload.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    fileUpload.classList.add('dragover');
                });
                fileUpload.addEventListener('dragleave', () => {
                    fileUpload.classList.remove('dragover');
                });
                fileUpload.addEventListener('drop', (e) => {
                    e.preventDefault();
                    fileUpload.classList.remove('dragover');
                    handleFiles(e.dataTransfer.files);
                });

                fileInput.addEventListener('change', (e) => {
                    handleFiles(e.target.files);
                });
            }
        }

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.size > 10 * 1024 * 1024) { // 10MB limit
                    alert(`Le fichier ${file.name} est trop volumineux (max 10MB).`);
                    return;
                }

                attachments.push({
                    name: file.name,
                    file: file
                });
            });

            updateFileList();
        }

        function updateFileList() {
            const fileList = document.getElementById('fileList');
            if (fileList) {
                fileList.innerHTML = '';

                attachments.forEach((attachment, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.innerHTML = `
                        <span class="file-name">${attachment.name}</span>
                        <button type="button" class="file-remove" onclick="removeFile(${index})">
                            <i class="bx bx-x"></i>
                        </button>
                    `;
                    fileList.appendChild(fileItem);
                });
            }
        }

        function removeFile(index) {
            attachments.splice(index, 1);
            updateFileList();
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initFileUpload();
            initCountryLists();
            initFormValidation();
            
            // Test modal - remove this after testing
            console.log('Modal element:', document.getElementById('applicationModal'));
            console.log('Modal classes:', document.getElementById('applicationModal').classList);
        });

        // Initialize form validation
        function initFormValidation() {
            // Add real-time validation
            document.querySelectorAll('#step1Form [required]').forEach(field => {
                field.addEventListener('blur', function() {
                    if (this.value.trim()) {
                        this.classList.remove('error');
                        hideFieldError(this);
                    }
                });
                
                field.addEventListener('input', function() {
                    if (this.value.trim()) {
                        this.classList.remove('error');
                        hideFieldError(this);
                    }
                });
            });
        }

        // Initialize country and phone code lists
        function initCountryLists() {
            // List of countries with their phone codes
            const countries = [
                { name: 'Sénégal', code: 'SN', phone: '+221' },
                { name: 'France', code: 'FR', phone: '+33' },
                { name: 'Côte d\'Ivoire', code: 'CI', phone: '+225' },
                { name: 'Maroc', code: 'MA', phone: '+212' },
                { name: 'Cameroun', code: 'CM', phone: '+237' },
                { name: 'Mali', code: 'ML', phone: '+223' },
                { name: 'Burkina Faso', code: 'BF', phone: '+226' },
                { name: 'Niger', code: 'NE', phone: '+227' },
                { name: 'Tchad', code: 'TD', phone: '+235' },
                { name: 'Guinée', code: 'GN', phone: '+224' },
                { name: 'Gambie', code: 'GM', phone: '+220' },
                { name: 'Guinée-Bissau', code: 'GW', phone: '+245' },
                { name: 'Sierra Leone', code: 'SL', phone: '+232' },
                { name: 'Liberia', code: 'LR', phone: '+231' },
                { name: 'Ghana', code: 'GH', phone: '+233' },
                { name: 'Togo', code: 'TG', phone: '+228' },
                { name: 'Bénin', code: 'BJ', phone: '+229' },
                { name: 'Nigeria', code: 'NG', phone: '+234' },
                { name: 'République du Congo', code: 'CG', phone: '+242' },
                { name: 'République démocratique du Congo', code: 'CD', phone: '+243' },
                { name: 'Gabon', code: 'GA', phone: '+241' },
                { name: 'Guinée équatoriale', code: 'GQ', phone: '+240' },
                { name: 'Sao Tomé-et-Principe', code: 'ST', phone: '+239' },
                { name: 'Angola', code: 'AO', phone: '+244' },
                { name: 'Zambie', code: 'ZM', phone: '+260' },
                { name: 'Zimbabwe', code: 'ZW', phone: '+263' },
                { name: 'Botswana', code: 'BW', phone: '+267' },
                { name: 'Namibie', code: 'NA', phone: '+264' },
                { name: 'Afrique du Sud', code: 'ZA', phone: '+27' },
                { name: 'Lesotho', code: 'LS', phone: '+266' },
                { name: 'Eswatini', code: 'SZ', phone: '+268' },
                { name: 'Mozambique', code: 'MZ', phone: '+258' },
                { name: 'Madagascar', code: 'MG', phone: '+261' },
                { name: 'Maurice', code: 'MU', phone: '+230' },
                { name: 'Seychelles', code: 'SC', phone: '+248' },
                { name: 'Comores', code: 'KM', phone: '+269' },
                { name: 'Djibouti', code: 'DJ', phone: '+253' },
                { name: 'Somalie', code: 'SO', phone: '+252' },
                { name: 'Éthiopie', code: 'ET', phone: '+251' },
                { name: 'Érythrée', code: 'ER', phone: '+291' },
                { name: 'Soudan', code: 'SD', phone: '+249' },
                { name: 'Soudan du Sud', code: 'SS', phone: '+211' },
                { name: 'Égypte', code: 'EG', phone: '+20' },
                { name: 'Libye', code: 'LY', phone: '+218' },
                { name: 'Tunisie', code: 'TN', phone: '+216' },
                { name: 'Algérie', code: 'DZ', phone: '+213' },
                { name: 'Canada', code: 'CA', phone: '+1' },
                { name: 'États-Unis', code: 'US', phone: '+1' },
                { name: 'Royaume-Uni', code: 'GB', phone: '+44' },
                { name: 'Allemagne', code: 'DE', phone: '+49' },
                { name: 'Italie', code: 'IT', phone: '+39' },
                { name: 'Espagne', code: 'ES', phone: '+34' },
                { name: 'Portugal', code: 'PT', phone: '+351' },
                { name: 'Belgique', code: 'BE', phone: '+32' },
                { name: 'Suisse', code: 'CH', phone: '+41' },
                { name: 'Pays-Bas', code: 'NL', phone: '+31' },
                { name: 'Suède', code: 'SE', phone: '+46' },
                { name: 'Norvège', code: 'NO', phone: '+47' },
                { name: 'Danemark', code: 'DK', phone: '+45' },
                { name: 'Finlande', code: 'FI', phone: '+358' },
                { name: 'Pologne', code: 'PL', phone: '+48' },
                { name: 'République tchèque', code: 'CZ', phone: '+420' },
                { name: 'Hongrie', code: 'HU', phone: '+36' },
                { name: 'Roumanie', code: 'RO', phone: '+40' },
                { name: 'Bulgarie', code: 'BG', phone: '+359' },
                { name: 'Grèce', code: 'GR', phone: '+30' },
                { name: 'Turquie', code: 'TR', phone: '+90' },
                { name: 'Russie', code: 'RU', phone: '+7' },
                { name: 'Chine', code: 'CN', phone: '+86' },
                { name: 'Japon', code: 'JP', phone: '+81' },
                { name: 'Corée du Sud', code: 'KR', phone: '+82' },
                { name: 'Inde', code: 'IN', phone: '+91' },
                { name: 'Brésil', code: 'BR', phone: '+55' },
                { name: 'Argentine', code: 'AR', phone: '+54' },
                { name: 'Chili', code: 'CL', phone: '+56' },
                { name: 'Colombie', code: 'CO', phone: '+57' },
                { name: 'Pérou', code: 'PE', phone: '+51' },
                { name: 'Venezuela', code: 'VE', phone: '+58' },
                { name: 'Mexique', code: 'MX', phone: '+52' },
                { name: 'Australie', code: 'AU', phone: '+61' },
                { name: 'Nouvelle-Zélande', code: 'NZ', phone: '+64' }
            ];

            // Sort countries alphabetically
            countries.sort((a, b) => a.name.localeCompare(b.name, 'fr'));

            // Populate country select
            const countrySelect = document.getElementById('country');
            const phoneCodeSelect = document.getElementById('phoneCode');

            if (countrySelect) {
                countries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country.code;
                    option.textContent = country.name;
                    countrySelect.appendChild(option);
                });
            }

            // Populate phone code select
            if (phoneCodeSelect) {
                countries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country.phone;
                    option.textContent = `${country.name} (${country.phone})`;
                    phoneCodeSelect.appendChild(option);
                });
            }

            // Link country and phone code selections
            if (countrySelect && phoneCodeSelect) {
                countrySelect.addEventListener('change', function() {
                    const selectedCountry = countries.find(c => c.code === this.value);
                    if (selectedCountry) {
                        phoneCodeSelect.value = selectedCountry.phone;
                    }
                });

                phoneCodeSelect.addEventListener('change', function() {
                    const selectedCountry = countries.find(c => c.phone === this.value);
                    if (selectedCountry) {
                        countrySelect.value = selectedCountry.code;
                    }
                });
            }
        }

        // Close modal when clicking outside
        document.getElementById('applicationModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeApplicationModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeApplicationModal();
            }
        });

        // Handle rerun button click
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('rerun-button')) {
                document.querySelector('.modal-wrap').classList.remove('animate-up');
                document.querySelectorAll('.modal-body').forEach(body => {
                    body.classList.remove('is-showing');
                });
                document.querySelector('.modal-body-step-1').classList.add('is-showing');
                
                document.querySelectorAll('.modal-header span').forEach((span, index) => {
                    span.classList.toggle('is-active', index === 0);
                });
                
                e.target.style.display = 'none';
            }
        });
    </script>
</body>
</html>
